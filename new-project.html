<!DOCTYPE html>
<!-- DESCRIPTION: Page to create a new project for oneself. -->
<html>

<head>
  <title>Wot 'n' Carnation</title>
  <!-- FONTS -->
  <link href="https://fonts.googleapis.com/css?family=Roboto:300,400,700" rel="stylesheet">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

  <!-- CSS -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.98.1/css/materialize.min.css">
  <link rel="stylesheet" href="css/main.css" type="text/css">

  <!--Let browser know website is optimized for mobile-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- JS -->
  <script src="https://code.jquery.com/jquery-3.2.1.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
    crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.98.1/js/materialize.min.js"></script>
  <script src="js/main.js"></script>
</head>

<body>
  <!--Nav and hamburger menu-->
  <nav class="red lighten-1">
    <div class="nav-wrapper">
      <a href="#" class="brand-logo">New Project</a>
      <a href="home-page.html" class="btn-floating btn-large halfway-fab waves-effect waves-light red accent-1">
        <i class="material-icons">arrow_back</i>
      </a>
    </div>
  </nav>

  <!--Main-->
  <div class="row">
    <br>
    <label id="upload-project-pic" for="profile-picture" class="btn red accent-1 col s4 offset-s4">Upload a picture</label>
    <input type="file" style="visibility: hidden;" id="profile-picture" onchange="previewFile()">
    <img class="col s6 offset-s3" src="" height="200px" width="300px">
  </div>
  <div id="main" class="container">
    <div class="row">
      <div class="input-field col s6">
        <input id="project-name" type="text" class="validate">
        <label for="project-name">Project Name</label>
      </div>
    </div>
    <div class="row">
      <div class="input-field col s12">
        <textarea id="description" class="materialize-textarea validate"></textarea>
        <label for="description">Project Description</label>
      </div>
    </div>
    <div class="row">
      <div class="input-field col s6">
        <input id="valuation" type="number" value="200000" class="validate">
        <label for="valuation" class="active">Valuation</label>
      </div>
      <div class="input-field col s6">
        <input id="available" type="number" min="1" max="99" value="20" class="validate">
        <label for="available" class="active">Percent available to investors</label>
      </div>
    </div>
    <div class="row">
      <div class="input-field col s12">
        <div id="tags" class="chips chips-autocomplete"></div>
        <label for="tags">Tags</label>
      </div>
    </div>
    <a href="home-page.html">
      <button id="submit" class="btn red accent-1 waves-effect waves-light" type="submit" name="action">Submit
      <i class="material-icons right">send</i>
      </button>
    </a>
  </div>
  <script>
    function previewFile() {
      var preview = document.querySelector('img'); //selects the query named img
      var file = document.querySelector('input[type=file]').files[0]; //sames as here
      var reader = new FileReader();

      reader.onloadend = function () {
        preview.src = reader.result;
      }

      if (file) {
        reader.readAsDataURL(file); //reads the data as a URL
      } else {
        preview.src = "";
      }
    }

    previewFile();  //calls the function named previewFile()
    var _tags = []
    
    $('#submit').click(function () {
      $.each($(".chip"), function(index,val){
        var txt = val.textContent;
        _tags.push(txt.substring(0,txt.length-5)); //gets rid of the extra 'close' text at the end...
      })
      var newProject = {
        name: $("#project-name").val(),
        description: $("#description").val(),
        valuation: $("#valuation").val(),
        available: $("#available").val(),
        tags: _tags
      };

      if (localStorage.projects) {
        projects = JSON.parse(localStorage.projects);
      }
      else {
        projects = [];
      };

      projects.push(newProject);

      localStorage.projects = JSON.stringify(projects);
    });
  </script>
</body>

</html>